## A5: Relational Schema, validation and schema refinement

This artifact contains the Relational Schema made by mapping the Conceptual Data Model and represents the relation schema, attributes, domains, primary keys, foreign keys and other integrity rules that will be included in the database.

### 1. Relational Schema
Relation reference| Relation Compact Notation |
--- | --- |
R01 | users(<ins>id</ins>, name **NN**, email **NN** **UK** **CK** valid_email_format, password **NN**)
R02 | admins(<ins>id</ins>, name **NN**, password **NN**)
R03 | company(<ins>id</ins>, name **NN**)
R04 | project(<ins>id</ins>, company_id -> company, name **NN**, details, creation **NN DF** today **CK** creation<=today,delivery **NN CK** delivery>=creation)
R05 | project_member(<ins>users_id</ins> -> users, <ins>project_id</ins> -> project, is_favourite **NN DF** false)
R06 | project_coordinator(<ins>id</ins>, users_id -> users, project_id -> project)
R07 | task(<ins>id</ins>, project_id -> project, creator -> users, name **NN**, details, status **NN**, creation **NN DF** today **CK** creation<=today, delivery **NN CK** delivery>=creation)
R08 | task_assigned(<ins>users_id</ins> -> users, <ins>task_id</ins> -> task)
R09 | comment(<ins>id</ins>, task_id -> task, author -> users, content **NN**, creation **NN DF** today **CK** creation<=today)
R10 | invitation(<ins>project_id</ins> -> project, <ins>users_id</ins> -> users, <ins>project_coordinator_id</ins> -> project_coordinator)
R11 | notification()

Legend:

 - UK = UNIQUE KEY

 - NN = NOT NULL 

 - DF = DEFAULT 

 - CK = CHECK

### 2. Domains
Domain Name| Domain Specification |
--- | --- |
today | TIMESTAMP DEFAULT CURRENT_DATE
status | ENUM('Completed', 'Ongoing', 'Paused', 'Abandoned')

### 3. Schema validation
Table R01| users |
--- | --- |
**Keys:** {id},{email} 
**Functional Dependencies**
FD0101 | {id} -> {name, email, password}
FD0102 | {email} -> {id, name, password}
**Normal Form** | BCNF

Table R02| admins |
--- | --- |
**Keys:** {id}
**Functional Dependencies**
FD0201 | {id} -> {name, password}
**Normal Form** | BCNF

Table R03| company |
--- | --- |
**Keys:** {id}
**Functional Dependencies**
FD0301 | {id} -> {name}
**Normal Form** | BCNF

Table R04| project |
--- | --- |
**Keys:** {id}
**Functional Dependencies**
FD0401 | {id} -> {company_id, name, details, creation, delivery}
**Normal Form** | BCNF

Table R05| project_member |
--- | --- |
**Keys:** {users_id, project_id}
**Functional Dependencies**
FD0501 | {users_id, project_id} -> {is_favourite}
**Normal Form** | BCNF

Table R06| project_coordinator |
--- | --- |
**Keys:** {id}
**Functional Dependencies**
FD0601 | {id} -> {users_id, project_id}
**Normal Form** | BCNF

Table R07| task |
--- | --- |
**Keys:** {id}
**Functional Dependencies**
FD0701 | {id} -> {project_id, creator, name, details, status, creation, delivery}
**Normal Form** | BCNF

Table R08| task_assigned |
--- | --- |
**Keys:** {users_id, task_id}
**Functional Dependencies** | none
**Normal Form** | BCNF

Table R09| comment |
--- | --- |
**Keys:** {id}
**Functional Dependencies**
FD0901 | {id} -> {task_id, author, content, creation}
**Normal Form** | BCNF

Table R010| invitation |
--- | --- |
**Keys:** {project_id, users_id, project_coordinator_id}
**Functional Dependencies** | none
**Normal Form** | BCNF

Table R011| notification |
--- | --- |
**Keys:** {}
**Functional Dependencies**
FD1101 | 
**Normal Form** | BCNF

Because all relations are in the Boyceâ€“Codd Normal Form (BCNF), the relational schema is also in the BCNF and, therefore, the schema does not need to be further normalized.

## Annex A. SQL Code

### A.1. Database Schema

```sql
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS admins;
DROP TABLE IF EXISTS company;
DROP TABLE IF EXISTS project CASCADE;
DROP TABLE IF EXISTS project_member;
DROP TABLE IF EXISTS project_coordinator;
DROP TABLE IF EXISTS task CASCADE;
DROP TABLE IF EXISTS task_assigned;
DROP TABLE IF EXISTS comment CASCADE;
DROP TABLE IF EXISTS invitation;

DROP TYPE IF EXISTS status;


CREATE TYPE status AS ENUM ('Completed', 'Ongoing', 'Paused', 'Abandoned');

CREATE TABLE users(
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL,
    CONSTRAINT valid_email_format CHECK (email ~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')
);

CREATE TABLE admins(
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL, 
    password TEXT NOT NULL
);

CREATE TABLE company(
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE project (
    id SERIAL PRIMARY KEY,
    company_id REFERENCES company(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    details TEXT,
    creation TIMESTAMP WITH TIME ZONE DEFAULT now(),
    delivery TIMESTAMP WITH TIME ZONE CHECK (delivery >= creation)
);

CREATE TABLE project_member(
    users_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    project_id INTEGER NOT NULL REFERENCES project(id) ON DELETE CASCADE,
    is_favorite BOOLEAN DEFAULT FALSE;
    PRIMARY KEY(project_id, users_id)
);

CREATE TABLE project_coordinator(
    id SERIAL PRIMARY KEY,
    users_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    project_id INTEGER NOT NULL REFERENCES project(id) ON DELETE CASCADE
);

CREATE TABLE task(
    id SERIAL PRIMARY KEY,
    project_id INTEGER NOT NULL REFERENCES project(id) ON DELETE CASCADE,
    creator INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    details TEXT,
    TYPE status NOT NULL,
    creation TIMESTAMP WITH TIME ZONE DEFAULT now(),
    delivery TIMESTAMP WITH TIME ZONE CHECK (delivery >= creation)
);


CREATE TABLE task_assigned(
    users_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    task_id INTEGER NOT NULL REFERENCES task(id) ON DELETE CASCADE,
    PRIMARY KEY(users_id, task_id)
);

CREATE TABLE comment(
    id SERIAL PRIMARY KEY,
    author INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    task_id INTEGER NOT NULL REFERENCES task(id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    creation TIMESTAMP WITH TIME ZONE DEFAULT now()
);


CREATE TABLE invitation(
    project_id INTEGER NOT NULL REFERENCES project(id) ON DELETE CASCADE,
    users_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    project_coordinator_id INTEGER NOT NULL REFERENCES project_coordinator(id) ON DELETE CASCADE,
    PRIMARY KEY(project_id, users_id, project_coordinator_id)
);
```
